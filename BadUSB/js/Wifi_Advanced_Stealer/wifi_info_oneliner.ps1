$rPp = "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkList\Profiles\";$rUp = 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkList\Signatures\Unmanaged';$r = @();$wP = netsh wlan show profiles | Select-String ':\s*(.+)$' | %{$_.Matches.Groups[1].Value};function dD {param ($rD);$dV = @();for ($i = 0; $i -lt $rD.Length; $i += 2) {$bP = $rD[$i..($i+1)];$hP = $bP | ForEach-Object { '{0:X2}' -f $_ };$iH = $hP[1] + $hP[0];$dVa = [convert]::ToInt32($iH, 16);$dV += $dVa};$y = $dV[0];$m = $dV[1];$d = $dV[3];$h = $dV[4];$mi = $dV[5];$s = $dV[6];$mil = $dV[7];if ($mil -gt 999) {$mil = 999};$dT = New-Object DateTime($y, $m, $d, $h, $mi, $s, $mil);$fD = $dT.ToString("dd/MM/yyyy HH:mm:ss");return $fD};foreach ($p in $wP) {if ($p.length -gt 1) {$sk = '';(netsh wlan show profile name=$p key=clear) | Select-String '(Contenu|Key).*:(.+)$' | %{$sk = $_.Matches.Groups[2].Value.Trim()};$sKs = gci -Path $rUp;foreach ($sKe in $sKs) {$de = gp -Path $sKe.PSPath -Name 'Description' -ErrorAction SilentlyContinue;if ($de -and $de.Description -like '*'+$p+'*') {$dGM = gp -Path $sKe.PSPath -Name 'DefaultGatewayMac' -ErrorAction SilentlyContinue;if ($dGM) {$mH = ($dGM.DefaultGatewayMac | %{ '{0:X2}' -f $_ }) -join ':'}}};$sKsP = gci -Path $rPp;foreach ($sKeP in $sKsP) {$el = gp -Path $sKeP.PSPath -Name 'Description' -ErrorAction SilentlyContinue;if ($el -and $el.Description -like '*'+$p+'*') {$LDCR = '';$LDCR = (gp -Path $sKeP.PSPath -Name 'DateLastConnected' -ErrorAction SilentlyContinue).DateLastConnected;if ($LDCR) {$fD = dD($LDCR)};$FDCR = (gp -Path $sKeP.PSPath -Name 'DateCreated' -ErrorAction SilentlyContinue).DateCreated;if ($FDCR) {$fD2 = dD($FDCR)}}};$r += [PSCustomObject]@{SSID = $p;BSSID = $mH;Key = $sk;LastConnected = $fD;FirstConnected = $fD2}}};$r | sort-object -Property LastConnected | Format-Table -AutoSize